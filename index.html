<!doctype html>
<html lang="en-us">

<head>
	<meta charset="UTF-8">
	<title>Mood Food</title>

	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

	<!-- External Asset Stylesheets -->
	<link rel="stylesheet" type="text/css" href="assets/css/reset.css">
	<link rel="stylesheet" type="text/css" href="assets/css/style.css">
	<link rel="stylesheet" type="text/css" href="assets/css/background.css">

	<!-- jQuery 1.x -->
	<script
	  src="https://code.jquery.com/jquery-1.12.4.js"
	  integrity="sha256-Qw82+bXyGq6MydymqBxNPYTaUXXq7c8v3CwiYwLLNXU="
	  crossorigin="anonymous">
	</script>

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous">
	</script>

	<!-- AJAX -->
	 <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script> 

    <!-- Firebase JavaScript Link -->
   <script src="https://www.gstatic.com/firebasejs/live/3.0/firebase.js"></script> 

	<!-- Added Moment JS -->
	 <script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script> 

	<!-- Added Materialize -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">

	
</head>

<body>
	
	<div class="pulse">
		<img src="assets/images/logo1.2.png" class="pulse" id="logo">
		</div>

		
		<a href="index-FaceScan.html" class="btn btn-floating btn-large pulse" id="button-1"><i class="material-icons" id="button-text">WHAT DO I WANT TO EAT?</i></a>
		

<canvas id="canvas">
</canvas>
  

<script type="text/javascript">

window.onload = function() {
  var startPos;
  var whereAmI = navigator.geolocation.getCurrentPosition(function(position) {
  	console.log("Where am I: " + position)
    // same as above
  }, function(error) {
    alert('Error occurred. Error code: ' + error.code);
    // error.code can be:
    //   0: unknown error
    //   1: permission denied
    //   2: position unavailable (error response from locaton provider)
    //   3: timed out
  });
};

// define constraints, audio, video or both
var constraints = {
  video: {
    mandatory: {
      maxWidth: 640,
      maxHeight: 360
    }
  }
};

// MediaDevices.getUserMedia()  With the user's permission through a prompt, turns on a camera or screensharing and/or a microphone on the system and provides a MediaStream containing a video track and/or an audio track with the input.
navigator.mediaDevices.getUserMedia(constraints)

.then(function(stream) {
        video.srcObject = stream;
        video.play();
    })
    .catch(function(err) {
//  if err, permission denied, ask for mood? or display all moods and have them click on? 

        console.log("An error occured! " + err);
    });

// The querySelector() method returns the first element that matches a specified CSS selector(s) in the document.
  var video = document.querySelector("#video");
  var canvas = document.querySelector("#canvas");
  var ctx = canvas.getContext("video");
  var localMediaStream = document.querySelector(video.srcObject);

  function snapshot() {
  	    if (localMediaStream) {
      ctx.drawImage(video, 0, 0);
      document.querySelector('img').src = canvas.toDataURL('image/webp');
    }
  }

document.querySelector("#start-camera").onclick = function(e) {
	canvas.getContext("2d").drawImage(video, 0, 0);
	var snap = canvas.toDataURL();
  snapReduced = snap.replace("data:image/png;base64,", "");
	// console.log(snapReduced)

// Need a name for emoji face "button"
  $("#button-1").on("click", function() {
      var queryURL = "https://cors-anywhere.herokuapp.com/https://api-us.faceplusplus.com/facepp/v3/detect";
      // the ajax will call to the URL with a promise to return the data when it is available. 
       $.ajax({
        url: queryURL,
        method: "POST",
        data: {
          api_key:"p6UKO6ReXnPt97o_onB63zBEqgN9lid-",
          api_secret:"j6FMcivnXOlnv9V9JXem932TziruiJby",
          image_base64: snapReduced.toString(),
          return_attributes:"emotion"
         }
      }).done(function(response) {

// Assign a variable to each emotion return to isolate the numeric value
      var anger = response.faces[0].attributes.emotion.anger;
      var disgust = response.faces[0].attributes.emotion.disgust;
      var fear = response.faces[0].attributes.emotion.fear;
      var happiness = response.faces[0].attributes.emotion.happiness;
      var neutral = response.faces[0].attributes.emotion.neutral;
      var sadness = response.faces[0].attributes.emotion.sadness;
      var surprise = response.faces[0].attributes.emotion.surprise;

      var emotionArray = [];
      emotionArray.push({
        emotion: "anger",
        value: anger
      });
      emotionArray.push({
        emotion: "disgust",
        value: disgust
      });emotionArray.push({
        emotion: "fear",
        value: fear
      });emotionArray.push({
        emotion: "happiness",
        value: happiness
      });emotionArray.push({
        emotion: "neutral",
        value: neutral
      });emotionArray.push({
        emotion: "sadness",
        value: sadness
      });
      emotionArray.push({
        emotion: "surprise",
        value: surprise
      });
      // create the highestVal variable. Then loop through the array and compare each value to determine the highest
      var highestVal = {
        value: 0
      };
      for (var i = 0; i < emotionArray.length; i++) {
        if (emotionArray[i].value > highestVal.value) {
          highestVal = emotionArray[i];
        }      }
      console.log(highestVal.emotion);
      
       // Clear sessionStorage
      sessionStorage.clear();

      // Store all content into sessionStorage
      sessionStorage.setItem("emotion", highestVal.emotion);
      });
    });

};

	// <!-- Output Table -->



	// <!-- Submit Form  -->



	// <!-- 	Java Code from game.js -->
	// <script src="assets/javascript/app.js">

<script src="assets/javascript/app.js"></script>

		

</script>

</body>

</html>